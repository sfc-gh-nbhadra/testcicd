QUERY_ID,QUERY_TEXT,DATABASE_ID,DATABASE_NAME,SCHEMA_ID,SCHEMA_NAME,QUERY_TYPE,SESSION_ID,USER_NAME,ROLE_NAME,WAREHOUSE_ID,WAREHOUSE_NAME,WAREHOUSE_SIZE,WAREHOUSE_TYPE,CLUSTER_NUMBER,QUERY_TAG,EXECUTION_STATUS,ERROR_CODE,ERROR_MESSAGE,START_TIME,END_TIME,TOTAL_ELAPSED_TIME,BYTES_SCANNED,PERCENTAGE_SCANNED_FROM_CACHE,BYTES_WRITTEN,BYTES_WRITTEN_TO_RESULT,BYTES_READ_FROM_RESULT,ROWS_PRODUCED,ROWS_INSERTED,ROWS_UPDATED,ROWS_DELETED,ROWS_UNLOADED,BYTES_DELETED,PARTITIONS_SCANNED,PARTITIONS_TOTAL,BYTES_SPILLED_TO_LOCAL_STORAGE,BYTES_SPILLED_TO_REMOTE_STORAGE,BYTES_SENT_OVER_THE_NETWORK,COMPILATION_TIME,EXECUTION_TIME,QUEUED_PROVISIONING_TIME,QUEUED_REPAIR_TIME,QUEUED_OVERLOAD_TIME,TRANSACTION_BLOCKED_TIME,OUTBOUND_DATA_TRANSFER_CLOUD,OUTBOUND_DATA_TRANSFER_REGION,OUTBOUND_DATA_TRANSFER_BYTES,INBOUND_DATA_TRANSFER_CLOUD,INBOUND_DATA_TRANSFER_REGION,INBOUND_DATA_TRANSFER_BYTES,LIST_EXTERNAL_FILES_TIME,CREDITS_USED_CLOUD_SERVICES,RELEASE_VERSION,EXTERNAL_FUNCTION_TOTAL_INVOCATIONS,EXTERNAL_FUNCTION_TOTAL_SENT_ROWS,EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS,EXTERNAL_FUNCTION_TOTAL_SENT_BYTES,EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES,QUERY_LOAD_PERCENT,IS_CLIENT_GENERATED_STATEMENT,QUERY_ACCELERATION_BYTES_SCANNED,QUERY_ACCELERATION_PARTITIONS_SCANNED,QUERY_ACCELERATION_UPPER_LIMIT_SCALE_FACTOR,TRANSACTION_ID,CHILD_QUERIES_WAIT_TIME,ROLE_TYPE,QUERY_HASH,QUERY_HASH_VERSION,QUERY_PARAMETERIZED_HASH,QUERY_PARAMETERIZED_HASH_VERSION,SECONDARY_ROLE_STATS,ROWS_WRITTEN_TO_RESULT,QUERY_RETRY_TIME,QUERY_RETRY_CAUSE,FAULT_HANDLING_TIME
01ac39b6-0404-830b-0031-1507004b205e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET 
    MASK_BILL_PROV_LAST_NM = 1,
    MASK_RNDRNG_PROV_LAST_NM = 1,
    MASK_BILL_PROV_FIRST_NM = 1,
    MASK_RNDRNG_PROV_FIRST_NM = 1,
    MASK_BILL_PROV_ID_CD = 1,
    MASK_PCP_PROV_ID_CD = 1,
    MASK_RNDRNG_PROV_ID_CD = 1,
    MASK_NPI_BILL_PROV_ID_CD = 1,
    MASK_NPI_PCP_PROV_ID_CD = 1,
    MASK_NPI_RNDRNG_PROV_ID_CD = 1,
    MASK_SRVC_LOCN_NPI = 1,
    MASK_BILL_PROV_TAX_ID_CD = 1, 
    MASK_BILL_PROV_TXNMY_CD = 1,
    -- NEW FIELDS
    MASK_BILL_PROV_SPCLT_CD = 1,
    MASK_PCP_PROV_SPCLT_CD = 1,
    MASK_RNDRNG_PROV_SPCLT_CD = 1,
    MASK_RNDRNG_PROV_TXNMY_CD = 1,
    MASK_RNDRNG_PROVTP_CD = 1

WHERE(
    EXISTS (
    -- M + txnmy fields
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON sr.ATRBT_VAL IN (pos.BILL_PROV_TXNMY_CD,pos.RNDRNG_PROV_TXNMY_CD)
            AND sr.actn_cd = 'J'
            AND sr.atrbt_cd = 'PRVDR_TXNMY_CD'
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    -- M + spclt fields
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.provider_specialty_map_reference as psmr -- cross walk table
            ON psmr.prov_spclt_cd IN (pos.BILL_PROV_SPCLT_CD, pos.PCP_PROV_SPCLT_CD, pos.RNDRNG_PROV_SPCLT_CD)
        INNER JOIN NDWAE_REL_POC.utilities.state_regs as sr
            ON sr.atrbt_val = psmr.its_prov_spclt_cd
            AND sr.actn_cd = 'J'
            AND sr.atrbt_cd = 'PRVDR_SPCLT_CD'
            AND sr.reg_typ_cd = 'M'
        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    -- P + txnmy fields
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD 
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON sr.ATRBT_VAL IN (pos.BILL_PROV_TXNMY_CD, pos.RNDRNG_PROV_TXNMY_CD)
            AND sr.actn_cd = 'J'
            AND sr.atrbt_cd = 'PRVDR_TXNMY_CD'
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    -- P + spclt fields
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD 
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.provider_specialty_map_reference as psmr -- cross walk table
            ON psmr.prov_spclt_cd IN (pos.BILL_PROV_SPCLT_CD, pos.PCP_PROV_SPCLT_CD, pos.RNDRNG_PROV_SPCLT_CD)
        INNER JOIN NDWAE_REL_POC.utilities.state_regs as sr
            ON sr.atrbt_val = psmr.its_prov_spclt_cd
            AND sr.actn_cd = 'J'
            AND sr.atrbt_cd = 'PRVDR_SPCLT_CD'
            AND sr.reg_typ_cd = 'P'
        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827958,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:22:35.073Z,2023-05-12T00:40:43.716Z,1088643,99145340535,0.6676130107,9474572800,0,0,1901881957,0,545919,0,0,0,36892,36892,0,0,89166598846,1473,745203,0,0,0,341967,,,0,,,0,0,0.000258,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850955775,0,ROLE,,,,,,0,,,
01ac39b6-0404-830a-0031-1507004affa2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK PFOM --- DOES UPDATE!!
SET
    MASK_BILL_PROV_FIRST_NM = 1,
    MASK_BILL_PROV_ID_CD = 1,
    MASK_BILL_PROV_LAST_NM = 1,
    MASK_BILL_PROV_TAX_ID_CD = 1,
    MASK_NPI_BILL_PROV_ID_CD = 1,
    MASK_NPI_PCP_PROV_ID_CD = 1,
    MASK_NPI_RNDRNG_PROV_ID_CD = 1,
    MASK_SRVC_LOCN_NPI = 1,
    MASK_PCP_PROV_ID_CD = 1,
    MASK_RNDRNG_PROV_FIRST_NM = 1,
    MASK_RNDRNG_PROV_LAST_NM = 1,
    MASK_RNDRNG_PROV_ID_CD = 1,
    -- NEW FIELDS
    MASK_BILL_PROV_SPCLT_CD = 1, 
    MASK_BILL_PROV_TXNMY_CD = 1, 
    MASK_PCP_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_TXNMY_CD = 1,
    MASK_RNDRNG_PROVTP_CD = 1

WHERE(
    EXISTS(
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS PFO
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER AS M
        ON M.MEMB_BID = PFO.MEMB_BID
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON PFO.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = PFO.BHI_HOME_PLAN_ID_CD
    INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
        ON PFO.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
        ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
        AND SR.ACTN_CD = 'I'
        AND SR.ATRBT_CD = 'PROV_TP_CD'
        AND SR.REG_TYP_CD = 'M'
    WHERE 
        SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
        AND (SR.HI_AGE_YR_NUM is NULL 
            OR (SR.HI_AGE_YR_NUM is not NULL 
            AND DATEDIFF(year, M.MEMB_BRTH_DT, PFO.SERV_FROM_DT) <= SR.HI_AGE_YR_NUM)) 
        AND DATEDIFF(day, SR.reg_eff_dt, PFO.SERV_FROM_DT) > 0 
        AND DATEDIFF(day, SR.reg_end_dt, PFO.SERV_END_DT) < 0
        AND PFO.PFO_CLM_BID = PFOM.PFO_CLM_BID
        )
    UNION
        (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS PFO
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER AS M
            ON M.MEMB_BID = PFO.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON PFO.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
            ON PSR.NDW_PLAN_CD = PFO.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
            ON PFO.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
            ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
            AND SR.ACTN_CD = 'I'
            AND SR.ATRBT_CD = 'PROV_TP_CD'
            AND SR.REG_TYP_CD = 'P'
        WHERE 
            SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
            AND (SR.HI_AGE_YR_NUM is NULL 
                OR (SR.HI_AGE_YR_NUM is not NULL 
                AND DATEDIFF(year, M.MEMB_BRTH_DT, PFO.SERV_FROM_DT) <= SR.HI_AGE_YR_NUM)) 
            AND DATEDIFF(day, SR.reg_eff_dt, PFO.SERV_FROM_DT) > 0 
            AND DATEDIFF(day, SR.reg_end_dt, PFO.SERV_END_DT) < 0
            AND PFO.PFO_CLM_BID = PFOM.PFO_CLM_BID
        )
    )
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844310,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:22:25.521Z,2023-05-12T00:28:17.772Z,352251,53929478733,0.770078404,7691847680,0,0,1462588210,0,187424,0,0,0,18667,18667,0,0,3611329624,1697,63274,0,0,0,287280,,,0,,,0,0,0.000297,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850946278,0,ROLE,,,,,,0,,,
01ac39b6-0404-830b-0031-1507004b2052,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
    SET POSM.MASK_TOS_CD = 1 -- we will need to iterate through this
    WHERE (
        EXISTS (
        (SELECT DISTINCT(POS.PFO_CLM_BID)
            FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
            INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
            ON M.MEMB_BID = POS.MEMB_BID
            INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
            LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR
            ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
            INNER JOIN NDWAE_REL_POC.NDWAE.TYPE_OF_SERVICE_MAP_REFERENCE as tosmr
            ON POS.TOS_CD = tosmr.tos_cd
            INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
                ON tosmr.ITS_TOS_CD = sr.ATRBT_VAL
                AND sr.actn_cd = 'G'
                AND sr.atrbt_cd = 'TOS_CD'
                AND sr.reg_typ_cd = 'M'
            WHERE
            sr.st_cd IN (zr.st_cd, psr.st_cd)
            AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND
            DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0
            AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
            )

        UNION

        (SELECT DISTINCT(POS.PFO_CLM_BID)
            FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
            INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
            ON M.MEMB_BID = POS.MEMB_BID
            INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
            LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR
            ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
            INNER JOIN NDWAE_REL_POC.NDWAE.TYPE_OF_SERVICE_MAP_REFERENCE as tosmr
            ON POS.TOS_CD = tosmr.tos_cd
            INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON tosmr.ITS_TOS_CD = sr.ATRBT_VAL
                AND sr.actn_cd = 'G'
                AND sr.atrbt_cd = 'TOS_CD'
                AND sr.reg_typ_cd = 'P'
            WHERE
            sr.st_cd IN (zr.st_cd, psr.st_cd)
            AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND
            DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0
            AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
            )
        ) -- Exists closes here
    ) -- where clause closes here;
    ;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844302,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:22:12.321Z,2023-05-12T00:27:13.584Z,301263,53743435467,0.8206718875,8610768384,0,0,1897794709,0,259231,0,0,0,18655,18655,0,0,3627721425,1889,58704,0,0,0,240670,,,0,,,0,0,0.000341,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850933235,0,ROLE,,,,,,0,,,
01ac39b6-0404-830a-0031-1507004aff9a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PRINC_ICD10_DIAG_HDR_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_HDR_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_HDR_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827954,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:22:01.688Z,2023-05-12T00:26:13.936Z,252248,57009682355,0.8074476197,8569267200,0,0,1905970325,0,16383588,0,0,0,18644,18644,0,0,5285278656,1845,65111,0,0,0,185292,,,0,,,0,0,0.000317,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850922578,0,ROLE,,,,,,0,,,
01ac39b6-0404-81fd-0031-1507004b140a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PRINC_ICD10_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827954,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:22:01.626Z,2023-05-12T00:25:07.877Z,186251,56802394072,0.8054417522,8355917824,0,0,1905970325,0,16383588,0,0,0,18632,18632,0,0,5283200376,1647,56188,0,0,0,128416,,,0,,,0,0,0.000283,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850922358,0,ROLE,,,,,,0,,,
01ac39b5-0404-830b-0031-1507004b2046,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844298,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:21:53.210Z,2023-05-12T00:24:10.817Z,137607,56082969935,0.8340287318,8138830336,0,0,1905970325,0,15303194,0,0,0,18616,18616,0,0,4921858900,2345,66507,0,0,0,68755,,,0,,,0,0,0.000397,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850914421,0,ROLE,,,,,,0,,,
01ac39b5-0404-81fd-0031-1507004b1402,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'H'
            AND sr.atrbt_cd = 'PLACE_OF_SERV_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'H'
            AND sr.atrbt_cd = 'PLACE_OF_SERV_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844290,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:21:44.711Z,2023-05-12T00:23:03.203Z,78492,49276604719,0.8269887614,6095142400,0,0,1464116796,0,14495,0,0,0,18601,18601,0,0,3542383663,2168,47215,0,0,0,29109,,,0,,,0,0,0.00037,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850905849,0,ROLE,,,,,,0,,,
01ac39b4-0404-81fd-0031-1507004b13e6,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK PFOM --- DOES UPDATE!!
SET
    MASK_BILL_PROV_FIRST_NM = 1,
    MASK_BILL_PROV_ID_CD = 1,
    MASK_BILL_PROV_LAST_NM = 1,
    MASK_BILL_PROV_TAX_ID_CD = 1,
    MASK_NPI_BILL_PROV_ID_CD = 1,
    MASK_NPI_PCP_PROV_ID_CD = 1,
    MASK_NPI_RNDRNG_PROV_ID_CD = 1,
    MASK_SRVC_LOCN_NPI = 1,
    MASK_PCP_PROV_ID_CD = 1,
    MASK_RNDRNG_PROV_FIRST_NM = 1,
    MASK_RNDRNG_PROV_LAST_NM = 1,
    MASK_RNDRNG_PROV_ID_CD = 1,
    -- NEW FIELDS
    MASK_BILL_PROV_SPCLT_CD = 1, 
    MASK_BILL_PROV_TXNMY_CD = 1, 
    MASK_PCP_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_TXNMY_CD = 1,
    MASK_RNDRNG_PROVTP_CD = 1

WHERE(
    EXISTS(
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS PFO
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER AS M
        ON M.MEMB_BID = PFO.MEMB_BID
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON PFO.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = PFO.BHI_HOME_PLAN_ID_CD
    INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
        ON PFO.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
        ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
        AND SR.ACTN_CD = 'I'
        AND SR.ATRBT_CD = 'PROV_TP_CD'
        AND SR.REG_TYP_CD = 'M'
    WHERE 
        SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
        AND (SR.HI_AGE_YR_NUM is NULL 
            OR (SR.HI_AGE_YR_NUM is not NULL 
            AND DATEDIFF(year, M.MEMB_BRTH_DT, PFO.SERV_FROM_DT) <= SR.HI_AGE_YR_NUM)) 
        AND DATEDIFF(day, SR.reg_eff_dt, PFO.SERV_FROM_DT) > 0 
        AND DATEDIFF(day, SR.reg_end_dt, PFO.SERV_END_DT) < 0
        AND PFO.PFO_CLM_BID = PFOM.PFO_CLM_BID
        )
    UNION
        (SELECT 1 FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS PFO
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER AS M
            ON M.MEMB_BID = PFO.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON PFO.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
            ON PSR.NDW_PLAN_CD = PFO.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
            ON PFO.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
            ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
            AND SR.ACTN_CD = 'I'
            AND SR.ATRBT_CD = 'PROV_TP_CD'
            AND SR.REG_TYP_CD = 'P'
        WHERE 
            SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
            AND (SR.HI_AGE_YR_NUM is NULL 
                OR (SR.HI_AGE_YR_NUM is not NULL 
                AND DATEDIFF(year, M.MEMB_BRTH_DT, PFO.SERV_FROM_DT) <= SR.HI_AGE_YR_NUM)) 
            AND DATEDIFF(day, SR.reg_eff_dt, PFO.SERV_FROM_DT) > 0 
            AND DATEDIFF(day, SR.reg_end_dt, PFO.SERV_END_DT) < 0
            AND PFO.PFO_CLM_BID = PFOM.PFO_CLM_BID
        )
    )
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840258,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:20:32.228Z,2023-05-12T00:42:46.279Z,1334051,182800575280,0.740612642,28793480192,0,0,6955019170,0,2715563,0,0,0,65522,65524,0,0,19447720117,2057,169870,0,0,0,1162124,,,0,,,0,0,0.000361,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850833164,0,ROLE,,,,,,0,,,
01ac39b4-0404-830a-0031-1507004aff8e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
    SET POSM.MASK_TOS_CD = 1 -- we will need to iterate through this
    WHERE (
        EXISTS (
        (SELECT DISTINCT(POS.PFO_CLM_BID)
            FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
            INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
            ON M.MEMB_BID = POS.MEMB_BID
            INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
            LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR
            ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
            INNER JOIN NDWAE_REL_POC.NDWAE.TYPE_OF_SERVICE_MAP_REFERENCE as tosmr
            ON POS.TOS_CD = tosmr.tos_cd
            INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
                ON tosmr.ITS_TOS_CD = sr.ATRBT_VAL
                AND sr.actn_cd = 'G'
                AND sr.atrbt_cd = 'TOS_CD'
                AND sr.reg_typ_cd = 'M'
            WHERE
            sr.st_cd IN (zr.st_cd, psr.st_cd)
            AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND
            DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0
            AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
            )

        UNION

        (SELECT DISTINCT(POS.PFO_CLM_BID)
            FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
            INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
            ON M.MEMB_BID = POS.MEMB_BID
            INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
            LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR
            ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
            INNER JOIN NDWAE_REL_POC.NDWAE.TYPE_OF_SERVICE_MAP_REFERENCE as tosmr
            ON POS.TOS_CD = tosmr.tos_cd
            INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON tosmr.ITS_TOS_CD = sr.ATRBT_VAL
                AND sr.actn_cd = 'G'
                AND sr.atrbt_cd = 'TOS_CD'
                AND sr.reg_typ_cd = 'P'
            WHERE
            sr.st_cd IN (zr.st_cd, psr.st_cd)
            AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND
            DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0
            AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
            )
        ) -- Exists closes here
    ) -- where clause closes here;
    ;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840254,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:20:22.086Z,2023-05-12T00:39:55.327Z,1173241,174843821086,0.7884222278,24191685120,0,0,6963579463,0,3750217,0,0,0,65482,65482,0,0,19563437973,2093,169168,0,0,0,1001980,,,0,,,0,0,0.00035,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850823115,0,ROLE,,,,,,0,,,
01ac39b4-0404-81fd-0031-1507004b13de,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PRINC_ICD10_DIAG_HDR_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_HDR_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_HDR_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827930,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:20:13.986Z,2023-05-12T00:34:09.734Z,835748,170599722977,0.7324812123,23109018624,0,0,6967432871,0,14595627,0,0,0,63865,65325,0,0,4682741833,2137,161694,0,0,0,671917,,,0,,,0,0,0.000372,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850814799,0,ROLE,,,,,,0,,,
01ac39b4-0404-830a-0031-1507004aff86,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PRINC_ICD10_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'B'
            AND sr.atrbt_cd = 'ICD10_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827930,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:20:13.917Z,2023-05-12T00:37:05.128Z,1011211,185237504415,0.7230956207,23764389888,0,0,6967891111,0,18282419,0,0,0,65379,65379,0,0,5940857298,2169,174360,0,0,0,834682,,,0,,,0,0,0.00038,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850814933,0,ROLE,,,,,,0,,,
01ac39b4-0404-81fd-0031-1507004b13d6,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844278,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:20:10.020Z,2023-05-12T00:31:26.753Z,676733,181960328574,0.8448685703,22453339648,0,0,6962490590,0,17023159,0,0,0,65315,65320,0,0,5526598828,2521,161259,0,0,0,512953,,,0,,,0,0,0.000459,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850811668,0,ROLE,,,,,,0,,,
01ac39b4-0404-81fd-0031-1507004b13d2,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840250,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:20:09.569Z,2023-05-12T00:28:44.637Z,515068,181487760264,0.7426899341,22450519552,0,0,6968159454,0,17023159,0,0,0,65321,65326,0,0,5526563493,3012,159016,0,0,0,353040,,,0,,,0,0,0.000495,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850811576,0,ROLE,,,,,,0,,,
01ac39b2-0404-830b-0031-1507004b201e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK fhm
SET MASK_BILL_PROV_FIRST_NM = 1,
    MASK_BILL_PROV_LAST_NM = 1,
    MASK_RNDRNG_PROV_FIRST_NM = 1,
    MASK_RNDRNG_PROV_LAST_NM = 1,
    MASK_ATTD_PROV_ID_CD = 1,
    MASK_BILL_PROV_ID_CD = 1,
    MASK_PCP_PROV_ID_CD = 1,
    MASK_RNDRNG_PROV_ID_CD = 1,
    MASK_NPI_ATTD_PROV_ID_CD = 1,
    MASK_NPI_BILL_PROV_ID_CD = 1,
    MASK_NPI_PCP_PROV_ID_CD = 1,
    MASK_NPI_RNDRNG_PROV_ID_CD = 1,
    MASK_BILL_PROV_TAX_ID_CD = 1,
    MASK_ATTD_PROV_TXNMY_CD = 1, 
    MASK_ATTD_PROV_SPCLT_CD = 1, 
    MASK_BILL_PROV_SPCLT_CD = 1, 
    MASK_BILL_PROV_TXNMY_CD = 1, 
    MASK_PCP_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_TXNMY_CD = 1, 
    MASK_RNDRNG_PROVTP_CD = 1
WHERE (
    EXISTS (
        -- M + TXNMY FIELDS
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON sr.ATRBT_VAL IN (fh.BILL_PROV_TXNMY_CD,fh.ATTD_PROV_TXNMY_CD,fh.RNDRNG_PROV_TXNMY_CD)
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd = 'PRVDR_TXNMY_CD'
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)  
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION 
        -- M + SPCLT FIELDS
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.provider_specialty_map_reference as psmr -- cross walk table
            ON psmr.prov_spclt_cd IN (fh.ATTD_PROV_SPCLT_CD,fh.BILL_PROV_SPCLT_CD,fh.PCP_PROV_SPCLT_CD,fh.RNDRNG_PROV_SPCLT_CD)
    INNER JOIN NDWAE_REL_POC.utilities.state_regs as sr
        ON sr.atrbt_val = psmr.its_prov_spclt_cd    
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd = 'PRVDR_SPCLT_CD'
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)  
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION 
    -- P + TXNMY FIELDS
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON sr.ATRBT_VAL IN (fh.BILL_PROV_TXNMY_CD,fh.ATTD_PROV_TXNMY_CD,fh.RNDRNG_PROV_TXNMY_CD, 
        fh.ATTD_PROV_SPCLT_CD,fh.BILL_PROV_SPCLT_CD,fh.PCP_PROV_SPCLT_CD,fh.RNDRNG_PROV_SPCLT_CD) 
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd IN ('PRVDR_SPCLT_CD', 'PRVDR_TXNMY_CD')
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        -- AND zr.st_cd = sr.st_cd 
    WHERE
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    UNION 
    -- P + SPCLT FIELDS
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
   INNER JOIN NDWAE_REL_POC.NDWAE.provider_specialty_map_reference as psmr -- cross walk table
            ON psmr.prov_spclt_cd IN (fh.ATTD_PROV_SPCLT_CD,fh.BILL_PROV_SPCLT_CD,fh.PCP_PROV_SPCLT_CD,fh.RNDRNG_PROV_SPCLT_CD)
    INNER JOIN NDWAE_REL_POC.utilities.state_regs as sr
        ON sr.atrbt_val = psmr.its_prov_spclt_cd    
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd = 'PRVDR_SPCLT_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        -- AND zr.st_cd = sr.st_cd 
    WHERE
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) 
) 
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844266,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:18:14.430Z,2023-05-12T00:20:50.498Z,156068,8815301656,0.8801560794,699607040,0,0,127832393,0,32305,0,0,0,3439,3439,0,0,15702665836,1899,88041,0,0,0,66128,,,0,,,0,0,0.000317,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850695828,0,ROLE,,,,,,0,,,
01ac39b2-0404-830b-0031-1507004b2016,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK FHM --- UPDATES ZERO RECORDS (NO MATCHES)
SET
    MASK_ATTD_PROV_ID_CD = 1,
    MASK_BILL_PROV_FIRST_NM = 1,
    MASK_BILL_PROV_ID_CD = 1,
    MASK_BILL_PROV_LAST_NM = 1,
    MASK_BILL_PROV_TAX_ID_CD = 1,
    MASK_NPI_ATTD_PROV_ID_CD = 1,
    MASK_NPI_BILL_PROV_ID_CD = 1,
    MASK_NPI_PCP_PROV_ID_CD = 1,
    MASK_NPI_RNDRNG_PROV_ID_CD = 1,
    MASK_PCP_PROV_ID_CD = 1,
    MASK_RNDRNG_PROV_FIRST_NM = 1,
    MASK_RNDRNG_PROV_LAST_NM = 1,
    MASK_RNDRNG_PROV_ID_CD = 1,
    MASK_ATTD_PROV_SPCLT_CD = 1,
    MASK_ATTD_PROV_TXNMY_CD = 1,
    MASK_BILL_PROV_SPCLT_CD = 1,
    MASK_BILL_PROV_TXNMY_CD = 1,
    MASK_PCP_PROV_SPCLT_CD = 1,
    MASK_RNDRNG_PROV_SPCLT_CD = 1,
    MASK_RNDRNG_PROV_TXNMY_CD = 1,
    MASK_RNDRNG_PROVTP_CD = 1
WHERE (
    EXISTS (
        (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER AS M
            ON M.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON FH.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
            ON PSR.NDW_PLAN_CD = FH.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
            ON FH.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
            ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
            AND SR.ACTN_CD = 'I'
            AND SR.ATRBT_CD = 'PROV_TP_CD'
            AND SR.REG_TYP_CD = 'M'
        WHERE 
            SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
            AND (SR.HI_AGE_YR_NUM IS NULL 
                OR (SR.HI_AGE_YR_NUM IS NOT NULL 
                AND DATEDIFF(year, M.MEMB_BRTH_DT, FH.FIRST_SERV_DT) <= SR.HI_AGE_YR_NUM)) 
            AND DATEDIFF(day, SR.reg_eff_dt, FH.FIRST_SERV_DT) > 0 
            AND DATEDIFF(day, SR.reg_end_dt, FH.FIRST_SERV_DT) < 0
            AND FH.FACIL_HDR_BID = FHM.FACIL_HDR_BID
        )
    UNION
        (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER AS M
            ON M.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON FH.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
            ON PSR.NDW_PLAN_CD = FH.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
            ON FH.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
            ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
            AND SR.ACTN_CD = 'I'
            AND SR.ATRBT_CD = 'PROV_TP_CD'
            AND SR.REG_TYP_CD = 'P'
        WHERE 
            SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
            AND (SR.HI_AGE_YR_NUM is NULL 
                OR (SR.HI_AGE_YR_NUM is not NULL 
                AND DATEDIFF(year, M.MEMB_BRTH_DT, FH.FIRST_SERV_DT) <= SR.HI_AGE_YR_NUM)) 
            AND DATEDIFF(day, SR.reg_eff_dt, FH.FIRST_SERV_DT) > 0 
            AND DATEDIFF(day, SR.reg_end_dt, FH.FIRST_SERV_DT) < 0
            AND FH.FACIL_HDR_BID = FHM.FACIL_HDR_BID
        )
    )
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840230,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:18:06.656Z,2023-05-12T00:19:21.964Z,75308,3504290880,0.8619472411,287836672,0,0,60978141,0,320,0,0,0,1735,1735,0,0,48752590,1428,11871,0,0,0,62009,,,0,,,0,0,0.000252,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850687321,0,ROLE,,,,,,0,,,
01ac39b1-0404-81fd-0031-1507004b13ba,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840222,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:17:51.079Z,2023-05-12T00:19:09.362Z,78283,4165474313,0.8572075504,501220864,0,0,120096447,0,737,0,0,0,1728,1730,0,0,48748818,800,17310,0,0,0,60173,,,0,,,0,0,0.000154,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850671415,0,ROLE,,,,,,0,,,
01ac39b1-0404-830b-0031-1507004b200a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_ICD10_PROC_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_PROC_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'D'
        AND sr.atrbt_cd = 'ICD10_PROC_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_PROC_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'D'
        AND sr.atrbt_cd = 'ICD10_PROC_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844262,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:17:38.491Z,2023-05-12T00:18:51.610Z,73119,4241542112,0.8676362471,525901824,0,0,127889737,0,17847,0,0,0,1733,1734,0,0,55239206,1199,16186,0,0,0,55734,,,0,,,0,0,0.000217,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850659172,0,ROLE,,,,,,0,,,
01ac39b1-0404-830b-0031-1507004b2006,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_PROC_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_PROC_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_PROC_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840214,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:17:24.869Z,2023-05-12T00:18:34.926Z,70057,4229027810,0.8707953443,517978112,0,0,127889737,0,17367,0,0,0,1736,1736,0,0,52321495,1694,18535,0,0,0,49828,,,0,,,0,0,0.000283,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850645577,0,ROLE,,,,,,0,,,
01ac39b1-0404-81fd-0031-1507004b13b2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_ICD10_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844258,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:17:03.397Z,2023-05-12T00:18:15.421Z,72024,4576687296,0.8291869421,508452352,0,0,127897929,0,1820809,0,0,0,1740,1740,0,0,699143522,1032,19902,0,0,0,51090,,,0,,,0,0,0.000191,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850623890,0,ROLE,,,,,,0,,,
01ac39b1-0404-81fd-0031-1507004b13ae,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_ADMTNG_ICD10_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_ICD10_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_ICD10_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844258,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:17:03.351Z,2023-05-12T00:17:55.030Z,51679,4489410570,0.8303610298,493147136,0,0,127897929,0,502830,0,0,0,1741,1741,0,0,241188878,953,27216,0,0,0,23510,,,0,,,0,0,0.000175,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850623801,0,ROLE,,,,,,0,,,
01ac39b0-0404-81fd-0031-1507004b13a2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_ADMTNG_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827906,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-12T00:16:45.874Z,2023-05-12T00:17:27.348Z,41474,4437259008,0.4610850501,478633984,0,0,127897929,0,445081,0,0,0,1743,1743,0,0,211988992,1706,19968,0,0,0,19800,,,0,,,0,0,0.000287,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850606660,0,ROLE,,,,,,0,,,
01ac39b0-0404-81fd-0031-1507004b139e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK fhm
SET MASK_BILL_PROV_FIRST_NM = 1,
    MASK_BILL_PROV_LAST_NM = 1,
    MASK_RNDRNG_PROV_FIRST_NM = 1,
    MASK_RNDRNG_PROV_LAST_NM = 1,
    MASK_ATTD_PROV_ID_CD = 1,
    MASK_BILL_PROV_ID_CD = 1,
    MASK_PCP_PROV_ID_CD = 1,
    MASK_RNDRNG_PROV_ID_CD = 1,
    MASK_NPI_ATTD_PROV_ID_CD = 1,
    MASK_NPI_BILL_PROV_ID_CD = 1,
    MASK_NPI_PCP_PROV_ID_CD = 1,
    MASK_NPI_RNDRNG_PROV_ID_CD = 1,
    MASK_BILL_PROV_TAX_ID_CD = 1,
    MASK_ATTD_PROV_TXNMY_CD = 1, 
    MASK_ATTD_PROV_SPCLT_CD = 1, 
    MASK_BILL_PROV_SPCLT_CD = 1, 
    MASK_BILL_PROV_TXNMY_CD = 1, 
    MASK_PCP_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_SPCLT_CD = 1, 
    MASK_RNDRNG_PROV_TXNMY_CD = 1, 
    MASK_RNDRNG_PROVTP_CD = 1
WHERE (
    EXISTS (
        -- M + TXNMY FIELDS
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON sr.ATRBT_VAL IN (fh.BILL_PROV_TXNMY_CD,fh.ATTD_PROV_TXNMY_CD,fh.RNDRNG_PROV_TXNMY_CD)
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd = 'PRVDR_TXNMY_CD'
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)  
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION 
        -- M + SPCLT FIELDS
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.provider_specialty_map_reference as psmr -- cross walk table
            ON psmr.prov_spclt_cd IN (fh.ATTD_PROV_SPCLT_CD,fh.BILL_PROV_SPCLT_CD,fh.PCP_PROV_SPCLT_CD,fh.RNDRNG_PROV_SPCLT_CD)
    INNER JOIN NDWAE_REL_POC.utilities.state_regs as sr
        ON sr.atrbt_val = psmr.its_prov_spclt_cd    
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd = 'PRVDR_SPCLT_CD'
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)  
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION 
    -- P + TXNMY FIELDS
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON sr.ATRBT_VAL IN (fh.BILL_PROV_TXNMY_CD,fh.ATTD_PROV_TXNMY_CD,fh.RNDRNG_PROV_TXNMY_CD, 
        fh.ATTD_PROV_SPCLT_CD,fh.BILL_PROV_SPCLT_CD,fh.PCP_PROV_SPCLT_CD,fh.RNDRNG_PROV_SPCLT_CD) 
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd IN ('PRVDR_SPCLT_CD', 'PRVDR_TXNMY_CD')
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        -- AND zr.st_cd = sr.st_cd 
    WHERE
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    UNION 
    -- P + SPCLT FIELDS
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
   INNER JOIN NDWAE_REL_POC.NDWAE.provider_specialty_map_reference as psmr -- cross walk table
            ON psmr.prov_spclt_cd IN (fh.ATTD_PROV_SPCLT_CD,fh.BILL_PROV_SPCLT_CD,fh.PCP_PROV_SPCLT_CD,fh.RNDRNG_PROV_SPCLT_CD)
    INNER JOIN NDWAE_REL_POC.utilities.state_regs as sr
        ON sr.atrbt_val = psmr.its_prov_spclt_cd    
        AND sr.actn_cd = 'J'
        AND sr.atrbt_cd = 'PRVDR_SPCLT_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        -- AND zr.st_cd = sr.st_cd 
    WHERE
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) 
) 
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840206,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:16:14.988Z,2023-05-12T00:26:16.681Z,601693,35243374289,0.821167425,2280287232,0,0,460043731,0,54272,0,0,0,13259,13259,0,0,64116114120,1291,396960,0,0,0,203442,,,0,,,0,0,0.000222,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850575616,0,ROLE,,,,,,0,,,
01ac39b0-0404-830b-0031-1507004b0ff2,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK FHM --- UPDATES ZERO RECORDS (NO MATCHES)
SET
    MASK_ATTD_PROV_ID_CD = 1,
    MASK_BILL_PROV_FIRST_NM = 1,
    MASK_BILL_PROV_ID_CD = 1,
    MASK_BILL_PROV_LAST_NM = 1,
    MASK_BILL_PROV_TAX_ID_CD = 1,
    MASK_NPI_ATTD_PROV_ID_CD = 1,
    MASK_NPI_BILL_PROV_ID_CD = 1,
    MASK_NPI_PCP_PROV_ID_CD = 1,
    MASK_NPI_RNDRNG_PROV_ID_CD = 1,
    MASK_PCP_PROV_ID_CD = 1,
    MASK_RNDRNG_PROV_FIRST_NM = 1,
    MASK_RNDRNG_PROV_LAST_NM = 1,
    MASK_RNDRNG_PROV_ID_CD = 1,
    MASK_ATTD_PROV_SPCLT_CD = 1,
    MASK_ATTD_PROV_TXNMY_CD = 1,
    MASK_BILL_PROV_SPCLT_CD = 1,
    MASK_BILL_PROV_TXNMY_CD = 1,
    MASK_PCP_PROV_SPCLT_CD = 1,
    MASK_RNDRNG_PROV_SPCLT_CD = 1,
    MASK_RNDRNG_PROV_TXNMY_CD = 1,
    MASK_RNDRNG_PROVTP_CD = 1
WHERE (
    EXISTS (
        (SELECT 1 FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER AS FH
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER AS M
            ON M.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON FH.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
            ON PSR.NDW_PLAN_CD = FH.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
            ON FH.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
            ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
            AND SR.ACTN_CD = 'I'
            AND SR.ATRBT_CD = 'PROV_TP_CD'
            AND SR.REG_TYP_CD = 'M'
        WHERE 
            SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
            AND (SR.HI_AGE_YR_NUM IS NULL 
                OR (SR.HI_AGE_YR_NUM IS NOT NULL 
                AND DATEDIFF(year, M.MEMB_BRTH_DT, FH.FIRST_SERV_DT) <= SR.HI_AGE_YR_NUM)) 
            AND DATEDIFF(day, SR.reg_eff_dt, FH.FIRST_SERV_DT) > 0 
            AND DATEDIFF(day, SR.reg_end_dt, FH.FIRST_SERV_DT) < 0
            AND FH.FACIL_HDR_BID = FHM.FACIL_HDR_BID
        )
    UNION
        (SELECT 1 FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER AS FH
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER AS M
            ON M.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
            ON FH.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
            ON PSR.NDW_PLAN_CD = FH.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.PROVIDER_TYPE_MAP_REFERENCE AS PTMR
            ON FH.RNDRNG_PROVTP_CD = PTMR.PROV_TP_CD 
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS AS SR
            ON SR.ATRBT_VAL = PTMR.ITS_PROV_TYP_CD
            AND SR.ACTN_CD = 'I'
            AND SR.ATRBT_CD = 'PROV_TP_CD'
            AND SR.REG_TYP_CD = 'P'
        WHERE 
            SR.ST_CD IN (ZR.ST_CD, PSR.ST_CD) 
            AND (SR.HI_AGE_YR_NUM is NULL 
                OR (SR.HI_AGE_YR_NUM is not NULL 
                AND DATEDIFF(year, M.MEMB_BRTH_DT, FH.FIRST_SERV_DT) <= SR.HI_AGE_YR_NUM)) 
            AND DATEDIFF(day, SR.reg_eff_dt, FH.FIRST_SERV_DT) > 0 
            AND DATEDIFF(day, SR.reg_end_dt, FH.FIRST_SERV_DT) < 0
            AND FH.FACIL_HDR_BID = FHM.FACIL_HDR_BID
        )
    )
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827902,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:16:06.109Z,2023-05-12T00:19:39.318Z,213209,10333140480,0.8515694373,144478208,0,0,31137792,0,18,0,0,0,6123,6700,0,0,45537066,1302,15509,0,0,0,196398,,,0,,,0,0,0.000224,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850566703,0,ROLE,,,,,,0,,,
01ac39af-0404-830b-0031-1507004b0fee,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844246,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:15:55.870Z,2023-05-12T00:19:23.127Z,207257,17015746528,0.8933912319,1652801536,0,0,397018579,0,6541,0,0,0,6649,6699,0,0,53138153,1087,33571,0,0,0,172599,,,0,,,0,0,0.000206,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850556479,0,ROLE,,,,,,0,,,
01ac39af-0404-830b-0031-1507004b0fea,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:15:54.712Z,2023-05-12T00:18:49.137Z,174425,17230572128,0.8899317672,1894246400,0,0,454915539,0,6541,0,0,0,6632,6682,0,0,49009638,1507,29717,0,0,0,143201,,,0,,,0,0,0.000266,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850555298,0,ROLE,,,,,,0,,,
01ac39af-0404-81fd-0031-1507004b1392,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_ICD10_PROC_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_PROC_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'D'
        AND sr.atrbt_cd = 'ICD10_PROC_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_PROC_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'D'
        AND sr.atrbt_cd = 'ICD10_PROC_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671827894,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:15:41.541Z,2023-05-12T00:18:18.516Z,156975,17949124824,0.8888051399,1875439616,0,0,455632339,0,15869,0,0,0,6677,6677,0,0,53319568,1451,29440,0,0,0,126084,,,0,,,0,0,0.000247,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850542226,0,ROLE,,,,,,0,,,
01ac39af-0404-830b-0031-1507004b0fde,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_PROC_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_PROC_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_PROC_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:15:27.128Z,2023-05-12T00:17:48.342Z,141214,17928144896,0.8912056486,1870895104,0,0,460002771,0,15370,0,0,0,6673,6673,0,0,50950417,1302,32841,0,0,0,107071,,,0,,,0,0,0.000229,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850527733,0,ROLE,,,,,,0,,,
01ac39af-0404-830b-0031-1507004b0fda,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_ICD10_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD10_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840190,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:15:11.959Z,2023-05-12T00:16:39.181Z,87222,19201603020,0.8643715881,1810522624,0,0,460158419,0,2152162,0,0,0,6669,6669,0,0,736244692,1122,30516,0,0,0,55584,,,0,,,0,0,0.000204,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850512488,0,ROLE,,,,,,0,,,
01ac39af-0404-830a-0031-1507004aff4a,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_ADMTNG_ICD10_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_ICD10_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_ICD10_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'B'
        AND sr.atrbt_cd = 'ICD10_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671840190,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:15:11.887Z,2023-05-12T00:17:14.828Z,122941,15863003177,0.8614902371,1842780672,0,0,460133843,0,111303,0,0,0,6635,6668,0,0,84327542,1515,34988,0,0,0,86438,,,0,,,0,0,0.000271,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850512726,0,ROLE,,,,,,0,,,
01ac39ae-0404-830b-0031-1507004b0fd6,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671844234,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-12T00:14:57.605Z,2023-05-12T00:16:08.084Z,70479,18920578920,0.8499076754,1767057408,0,0,460158419,0,2042176,0,0,0,6669,6669,0,0,670012329,1474,36892,0,0,0,32113,,,0,,,0,0,0.000255,7.16.1,0,0,0,0,0,100,false,0,0,0,1683850498363,0,ROLE,,,,,,0,,,
01ac2890-0404-8097-0031-15070047290e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_CPT_AND_HCPCS_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.CPT_AND_HCPCS_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'E'
            AND sr.atrbt_cd = 'HCPCS_PROC_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.CPT_AND_HCPCS_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'E'
            AND sr.atrbt_cd = 'HCPCS_PROC_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671729326,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:12:11.205Z,2023-05-08T23:22:54.647Z,643442,59110495687,0.6997534239,10277951488,0,0,1905257621,0,35290356,0,0,0,18849,18849,0,0,4032267649,2331,226161,0,0,178885,236065,,,0,,,0,0,0.000405,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587532109,0,ROLE,,,,,,0,,,
01ac2890-0404-8089-0031-150700471a6a,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_AND_OTHER_SERVICE_MASK POSM
SET POSM.MASK_CPT_AND_HCPCS_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.CPT_AND_HCPCS_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'E'
            AND sr.atrbt_cd = 'HCPCS_PROC_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, M.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    UNION
    (SELECT DISTINCT(POS.PFO_CLM_BID)
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE AS POS
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS ZR
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS PSR 
        ON PSR.NDW_PLAN_CD = POS.BHI_HOME_PLAN_ID_CD
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POS.CPT_AND_HCPCS_CD = sr.ATRBT_VAL 
            AND sr.actn_cd = 'E'
            AND sr.atrbt_cd = 'HCPCS_PROC_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
        AND POS.PFO_CLM_BID = POSM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671729326,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:12:11.137Z,2023-05-08T23:32:22.658Z,1211521,196609055308,0.7537299937,31872243200,0,0,6958393125,0,30094210,0,0,0,66036,66036,0,0,6001115529,1787,537659,0,0,52084,619991,,,0,,,0,0,0.000324,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587531859,0,ROLE,,,,,,0,,,
01ac2890-0404-80d0-0031-1507004756ca,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_DETAIL_MASK fdm
SET fdm.MASK_CPT_AND_HCPCS_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fd.facil_clm_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_DETAIL as fd
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fd.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fd.CPT_AND_HCPCS_CD = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'E'
        AND sr.atrbt_cd = 'HCPCS_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fd.facil_hdr_bid -- unfortunately due to data quality issues this will multiple the rows x2
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fd.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
    -- last condition is to link data pk with masking table pk
    AND fd.facil_clm_bid = fdm.facil_clm_bid
    )
    UNION
    (
    SELECT DISTINCT(fd.facil_clm_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_DETAIL as fd
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fd.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fd.CPT_AND_HCPCS_CD = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'E'
        AND sr.atrbt_cd = 'HCPCS_PROC_CD' 
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fd.facil_hdr_bid -- unfortunately due to data quality issues this will multiple the rows x2
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fd.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
    -- last condition is to link data pk with masking table pk
    AND fd.facil_clm_bid = fdm.facil_clm_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671729326,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:12:11.066Z,2023-05-08T23:18:08.695Z,357629,17976582935,0.5007470637,3097043456,0,0,714446164,0,3329508,0,0,0,4638,4638,0,0,5746684610,2511,52703,0,0,132556,169859,,,0,,,0,0,0.000438,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587532225,0,ROLE,,,,,,0,,,
01ac288f-0404-806a-0031-15070047377e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_REV_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.REV_CD = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'F'
            AND sr.atrbt_cd = 'REV_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.REV_CD = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'F'
            AND sr.atrbt_cd = 'REV_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671717074,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:11:57.242Z,2023-05-08T23:34:59.243Z,1382001,3041408320,0.9373257084,238403072,0,0,49864784,0,573679,0,0,0,1940,1940,0,0,1357564858,1379,43066,0,0,0,1337556,,,0,,,0,0,0.000231,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587517844,0,ROLE,,,,,,0,,,
01ac288f-0404-802d-0031-150700461dea,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_REV_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.REV_CD = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'F'
            AND sr.atrbt_cd = 'REV_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.REV_CD = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'F'
            AND sr.atrbt_cd = 'REV_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671717074,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:11:57.179Z,2023-05-08T23:38:17.273Z,1580094,14155390752,0.9270719085,855505408,0,0,180283630,0,371057,0,0,0,7411,7411,0,0,4240493501,1389,43280,0,0,0,1535425,,,0,,,0,0,0.000244,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587517815,0,ROLE,,,,,,0,,,
01ac288f-0404-8089-0031-150700471a4e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PLACE_OF_SERV_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'H'
        AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671741534,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:11:07.229Z,2023-05-08T23:22:55.022Z,707793,17713571671,0.8458456703,2350024192,0,0,381249123,0,6541,0,0,0,6731,6781,0,0,53876356,1281,68326,0,0,322367,315819,,,0,,,0,0,0.000227,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587467729,0,ROLE,,,,,,0,,,
01ac288f-0404-806a-0031-150700473772,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'H'
            AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PLACE_OF_SERV_CD = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'H'
            AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671741534,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:11:07.161Z,2023-05-08T23:34:15.422Z,1388261,2250662048,0.9601194253,3549696,0,0,811008,0,2,0,0,0,1856,1940,0,0,50655117,5565,6231,0,0,0,1376465,,,0,,,0,0,0.000907,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587467691,0,ROLE,,,,,,0,,,
01ac288f-0404-802d-0031-150700461dd2,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PLACE_OF_SERV_CD = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'H'
            AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PLACE_OF_SERV_CD = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'H'
            AND sr.atrbt_cd = 'PLACE_OF_SERV_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671741534,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:11:07.111Z,2023-05-08T23:37:33.271Z,1586160,13256222656,0.9481447648,770754560,0,0,162784448,0,6274,0,0,0,7339,7411,0,0,7483326477,1308,61966,0,0,0,1522886,,,0,,,0,0,0.00023,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587467624,0,ROLE,,,,,,0,,,
01ac288f-0404-802d-0031-150700461dce,"UPDATE NDWAE_REL_POC.NDWAE_MASK.ADMISSION_AGGREGATE_INBOUND_MASK aaim
SET MASK_PLACE_OF_SERV_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        --INNER JOIN ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER mem on mem.memb_bid = fh.memb_bid
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PLACE_OF_SERV_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'H'
            AND sr.ATRBT_CD = 'PLACE_OF_SERV_CD'
            AND sr.REG_TYP_CD = 'P'
        WHERE
        sr.st_cd IN (zp.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
    )
    UNION
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        --INNER JOIN ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER MEM on MEM.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PLACE_OF_SERV_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'H'
            AND sr.ATRBT_CD = 'PLACE_OF_SERV_CD'
            AND sr.REG_TYP_CD = 'M'
        WHERE
        sr.st_cd IN (zm.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
        )    
    )
)
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671741534,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:11:06.964Z,2023-05-08T23:19:08.699Z,481735,13992695127,0.992081071,50107392,0,0,12349265,0,675,0,0,0,7379,7453,0,0,3906874980,1944,30953,0,0,167569,281269,,,0,,,0,0,0.000328,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587467840,0,ROLE,,,,,,0,,,
01ac288e-0404-802d-0031-150700461dc6,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD5 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD5 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD5 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:38.326Z,2023-05-08T23:33:38.348Z,1380022,4876578464,0.8630313633,644377600,0,0,120586569,0,717,0,0,0,2148,2148,0,0,60233067,2057,35704,0,0,0,1342261,,,0,,,0,0,0.000344,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587439186,0,ROLE,,,,,,0,,,
01ac288e-0404-8030-0031-15070045ef8e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD5 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD5 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD5 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:38.273Z,2023-05-08T23:36:34.256Z,1555983,20535997312,0.8784677987,1801381888,0,0,328116973,0,500,0,0,0,7803,7953,0,0,65211208,2693,47973,0,0,0,1505317,,,0,,,0,0,0.000442,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587439422,0,ROLE,,,,,,0,,,
01ac288e-0404-8089-0031-150700471a4a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD4 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD4 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD4 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:38.171Z,2023-05-08T23:34:07.754Z,1409583,4933847552,0.8640878185,621888000,0,0,116109641,0,1030,0,0,0,2147,2147,0,0,61719540,2703,28429,0,0,0,1378451,,,0,,,0,0,0.000436,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587439874,0,ROLE,,,,,,0,,,
01ac288e-0404-806b-0031-150700467c36,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD4 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD4 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD4 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.965Z,2023-05-08T23:37:18.019Z,1600054,20996580480,0.9068837327,1986746368,0,0,366917075,0,685,0,0,0,7881,7956,0,0,66323082,2562,42786,0,0,0,1554706,,,0,,,0,0,0.000422,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587439530,0,ROLE,,,,,,0,,,
01ac288e-0404-8097-0031-1507004728f6,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD3 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD3 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:37.915Z,2023-05-08T23:31:23.929Z,1246014,5023171552,0.8603709627,677170688,0,0,126648649,0,2091,0,0,0,2142,2142,0,0,61333502,2225,33556,0,0,35978,1174255,,,0,,,0,0,0.000371,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438785,0,ROLE,,,,,,0,,,
01ac288e-0404-8089-0031-150700471a46,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD3 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD3 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.876Z,2023-05-08T23:38:09.608Z,1651732,21558316992,0.8981799019,2250679808,0,0,409646547,0,1240,0,0,0,7929,7959,0,0,68715512,2936,50434,0,0,0,1598362,,,0,,,0,0,0.000479,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587439635,0,ROLE,,,,,,0,,,
01ac288e-0404-802d-0031-150700461dc2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD2 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD2 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD2 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.832Z,2023-05-08T23:33:01.460Z,1343628,5024822592,0.8640488583,653110784,0,0,122310985,0,4932,0,0,0,2146,2146,0,0,67819634,2404,39098,0,0,16883,1285243,,,0,,,0,0,0.000405,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587439040,0,ROLE,,,,,,0,,,
01ac288e-0404-80d0-0031-1507004756ba,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD2 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD2 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD2 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:37.786Z,2023-05-08T23:35:44.760Z,1506974,21956222528,0.8841813917,2508232192,0,0,450876883,0,3471,0,0,0,7924,7954,0,0,80006955,2226,54282,0,0,0,1450466,,,0,,,0,0,0.000381,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438946,0,ROLE,,,,,,0,,,
01ac288e-0404-8030-0031-15070045ef8a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD1 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD1 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.727Z,2023-05-08T23:32:04.301Z,1286574,5036597696,0.8559109598,649986048,0,0,121721161,0,7877,0,0,0,2145,2145,0,0,81676889,2194,28515,0,0,10699,1245166,,,0,,,0,0,0.000367,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438895,0,ROLE,,,,,,0,,,
01ac288e-0404-802d-0031-150700461dbe,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_PROC_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD1 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_PROC_CD1 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:37.674Z,2023-05-08T23:34:49.437Z,1451763,22087954336,0.8828053499,2536814592,0,0,457020883,0,5801,0,0,0,7926,7950,0,0,114699082,1994,61139,0,0,0,1388630,,,0,,,0,0,0.000343,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438654,0,ROLE,,,,,,0,,,
01ac288e-0404-806b-0031-150700467c32,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_PROC_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_PROC_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_PROC_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'C'
        AND sr.atrbt_cd = 'ICD9_PROC_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.513Z,2023-05-08T23:16:23.552Z,346039,18010818070,0.841060729,1895539200,0,0,306490779,0,15370,0,0,0,6784,6784,0,0,49470885,1446,80223,0,0,181331,83039,,,0,,,0,0,0.000259,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438428,0,ROLE,,,,,,0,,,
01ac288e-0404-8089-0031-150700471a42,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD5 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD5 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD5 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.391Z,2023-05-08T23:34:01.855Z,1404464,2839104128,0.9157357176,231334912,0,0,48980048,0,4942,0,0,0,1941,1941,0,0,66688961,2122,20729,0,0,0,1381613,,,0,,,0,0,0.000363,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438815,0,ROLE,,,,,,0,,,
01ac288e-0404-802d-0031-150700461dba,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD5 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD5 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD5 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:37.323Z,2023-05-08T23:36:30.543Z,1553220,12111594496,0.9400146469,661192192,0,0,139354581,0,2739,0,0,0,7208,7409,0,0,77870821,1812,46016,0,0,0,1505392,,,0,,,0,0,0.000316,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438290,0,ROLE,,,,,,0,,,
01ac288e-0404-802d-0031-150700461db6,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD4 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD4 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD4 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.262Z,2023-05-08T23:33:16.291Z,1359029,2851919296,0.9172796789,234799104,0,0,49811536,0,6284,0,0,0,1941,1941,0,0,74934707,2443,20809,0,0,0,1335777,,,0,,,0,0,0.000404,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438172,0,ROLE,,,,,,0,,,
01ac288e-0404-80d0-0031-1507004756b6,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD4 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD4 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD4 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:37.217Z,2023-05-08T23:34:05.432Z,1408215,12486112544,0.9381459056,691693056,0,0,146166229,0,3424,0,0,0,7257,7407,0,0,84094419,1685,39818,0,0,0,1366712,,,0,,,0,0,0.000293,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587437934,0,ROLE,,,,,,0,,,
01ac288e-0404-8097-0031-1507004728f2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD3 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD3 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.161Z,2023-05-08T23:32:53.994Z,1336833,2849866880,0.9139630943,227918848,0,0,48177232,0,11662,0,0,0,1941,1941,0,0,80932293,2131,25399,0,0,0,1309303,,,0,,,0,0,0.000358,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587437964,0,ROLE,,,,,,0,,,
01ac288e-0404-8097-0031-1507004728ee,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD3 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD3 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:37.101Z,2023-05-08T23:34:53.624Z,1456523,12723625728,0.9413349207,747294720,0,0,158364117,0,5579,0,0,0,7265,7406,0,0,98835017,2327,46927,0,0,0,1407269,,,0,,,0,0,0.000382,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438152,0,ROLE,,,,,,0,,,
01ac288e-0404-80d0-0031-1507004756b2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD2 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD2 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD2 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:37.043Z,2023-05-08T23:32:27.270Z,1310227,2859218880,0.9097015028,230876160,0,0,49008720,0,24181,0,0,0,1941,1941,0,0,97978190,1890,23141,0,0,7349,1277847,,,0,,,0,0,0.000316,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587437884,0,ROLE,,,,,,0,,,
01ac288e-0404-80d0-0031-1507004756ae,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD2 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD2 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD2 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:36.962Z,2023-05-08T23:33:24.688Z,1367726,13001270304,0.9363970679,789950464,0,0,168306926,0,10802,0,0,0,7285,7405,0,0,143341966,1764,45149,0,0,0,1320813,,,0,,,0,0,0.000307,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587437861,0,ROLE,,,,,,0,,,
01ac288e-0404-806b-0031-150700467c2e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD1 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD1 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:10:36.896Z,2023-05-08T23:33:40.467Z,1383571,2869366560,0.9101621704,231086592,0,0,49038869,0,35261,0,0,0,1940,1940,0,0,123660858,2309,23350,0,0,0,1357912,,,0,,,0,0,0.000382,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438359,0,ROLE,,,,,,0,,,
01ac288e-0404-806b-0031-150700467c2a,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_PROC_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD1 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_PROC_CD1 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:36.839Z,2023-05-08T23:35:43.730Z,1506891,13380242464,0.9377666094,807147520,0,0,170750421,0,18151,0,0,0,7332,7407,0,0,206954876,2186,49375,0,0,0,1455330,,,0,,,0,0,0.000367,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438254,0,ROLE,,,,,,0,,,
01ac288e-0404-806a-0031-15070047376a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_PRINC_PROC_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PRINC_PROC_CD = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PRINC_PROC_CD = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:36.779Z,2023-05-08T23:31:55.758Z,1278979,2976833472,0.913816137,230846464,0,0,49038869,0,77613,0,0,0,1941,1941,0,0,246745319,2273,42581,0,0,15823,1218302,,,0,,,0,0,0.000391,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587437656,0,ROLE,,,,,,0,,,
01ac288e-0404-8030-0031-15070045ef82,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_PRINC_PROC_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PRINC_PROC_CD = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PRINC_PROC_CD = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'C'
            AND sr.atrbt_cd = 'ICD9_PROC_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:36.705Z,2023-05-08T23:32:38.695Z,1321990,13611918112,0.9338737791,776975360,0,0,165777877,0,52908,0,0,0,7354,7405,0,0,542032739,2317,43328,0,0,18157,1258188,,,0,,,0,0,0.000387,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587437703,0,ROLE,,,,,,0,,,
01ac288e-0404-802d-0031-150700461db2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.ADMISSION_AGGREGATE_INBOUND_MASK aaim
SET MASK_PRINC_PROC_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        --INNER JOIN ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER mem on mem.memb_bid = fh.memb_bid
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PRINC_PROC_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'C'
            AND sr.ATRBT_CD = 'ICD9_PROC_CD'
            AND sr.REG_TYP_CD = 'P'
        WHERE
        sr.st_cd IN (zp.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
    )
    UNION
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        --INNER JOIN ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER MEM on MEM.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PRINC_PROC_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'C'
            AND sr.ATRBT_CD = 'ICD9_PROC_CD'
            AND sr.REG_TYP_CD = 'M'
        WHERE
        sr.st_cd IN (zm.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
        )    
    )
)
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721198,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:10:36.654Z,2023-05-08T23:16:21.551Z,344897,3126705056,0.9933695722,15308288,0,0,3412364,0,8299,0,0,0,2025,2025,0,0,1214620180,2265,13850,0,0,170898,157884,,,0,,,0,0,0.000379,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587438011,0,ROLE,,,,,,0,,,
01ac2887-0404-80d0-0031-1507004756a2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_OTHER_SECONDARY_CONDITION_MASK poscm
SET poscm.MASK_SEC_ICD9_DIAG_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
    )
    UNION
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:53.052Z,2023-05-08T23:13:40.149Z,587097,72335908198,0.6852113288,10819453952,0,0,1904381077,0,1628622,0,0,0,24314,24314,0,0,4179029333,3151,127068,0,0,186803,270075,,,0,,,0,0,0.00052,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587034768,0,ROLE,,,,,,0,,,
01ac2887-0404-8030-0031-15070045ef6e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_OTHER_SECONDARY_CONDITION_MASK poscm
SET poscm.MASK_SEC_ICD9_DIAG_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
    )
    UNION
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:52.981Z,2023-05-08T23:23:30.228Z,1177247,223660803275,0.7598513449,30810330624,0,0,6883581210,0,2376422,0,0,0,85305,85305,0,0,11063672822,3856,433056,0,0,166499,573836,,,0,,,0,0,0.000627,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587034719,0,ROLE,,,,,,0,,,
01ac2887-0404-806a-0031-15070047375a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.PROFESSIONAL_OTHER_SECONDARY_CONDITION_MASK poscm
SET poscm.MASK_SEC_ICD9_DIAG_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
    )
    UNION
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:52.732Z,2023-05-08T23:18:37.934Z,885202,74956789105,0.7931710652,10948121088,0,0,1905921173,0,4885099,0,0,0,24298,24298,0,0,7581110550,3944,136861,0,0,160059,584338,,,0,,,0,0,0.000666,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587035692,0,ROLE,,,,,,0,,,
01ac2887-0404-802d-0031-150700461d92,"UPDATE NDWAE_REL_POC.NDWAE_MASK.PROFESSIONAL_OTHER_SECONDARY_CONDITION_MASK poscm
SET poscm.MASK_SEC_ICD9_DIAG_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.MEMB_CLM_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'M'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
    )
    UNION
    (SELECT DISTINCT(POSC.PFO_CLM_BID) 
        FROM NDWAE_REL_POC.NDWAE.PROFESSIONAL_OTHER_SECONDARY_CONDITION POSC
        INNER JOIN NDWAE_REL_POC.NDWAE.PROFESSIONAL_AND_OTHER_SERVICE POS
        ON POS.PFO_CLM_BID = POSC.PFO_CLM_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER M
        ON M.MEMB_BID = POS.MEMB_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZR 
        ON POS.RNDRNG_PROV_ZIP_CD = ZR.ZIP_CD
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
        ON psr.ndw_plan_cd = pos.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON POSC.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL 
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD' 
            AND sr.reg_typ_cd = 'P'

        WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, m.memb_brth_dt, POS.SERV_FROM_DT) <= sr.HI_AGE_YR_NUM)) AND
        DATEDIFF(day, sr.reg_eff_dt, POS.SERV_FROM_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, POS.SERV_FROM_DT) < 0 
    AND POSC.PFO_CLM_BID = POSCM.PFO_CLM_BID
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:52.675Z,2023-05-08T23:29:59.120Z,1566445,232559306926,0.7226725135,31365765632,0,0,6963911902,0,6531105,0,0,0,85287,85287,0,0,19370178422,3850,367307,0,0,20230,1175058,,,0,,,0,0,0.000631,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587035149,0,ROLE,,,,,,0,,,
01ac2887-0404-8091-0031-1507004705b2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD9 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:52.532Z,2023-05-08T23:28:40.050Z,1487518,5176554240,0.8557548954,684019712,0,0,127897929,0,150405,0,0,0,2147,2147,0,0,310796897,1780,33734,0,0,75029,1376975,,,0,,,0,0,0.0003,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587033384,0,ROLE,,,,,,0,,,
01ac2887-0404-8097-0031-1507004728d2,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD9 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:52.480Z,2023-05-08T23:31:05.410Z,1632930,22070289406,0.8735736612,2524292096,0,0,460133843,0,70003,0,0,0,7919,7952,0,0,608185666,2194,52523,0,0,29128,1549085,,,0,,,0,0,0.000373,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587033313,0,ROLE,,,,,,0,,,
01ac2887-0404-8091-0031-1507004705ae,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD8 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD8 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD8 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:52.428Z,2023-05-08T23:30:13.059Z,1580631,5191447296,0.8552100782,682630656,0,0,127897929,0,182336,0,0,0,2143,2143,0,0,366435497,2023,45175,0,0,46838,1486595,,,0,,,0,0,0.000342,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587033447,0,ROLE,,,,,,0,,,
01ac2887-0404-806b-0031-150700467c0e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD7 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:52.268Z,2023-05-08T23:26:50.373Z,1378105,5197827136,0.8541173063,684113920,0,0,127897929,0,219974,0,0,0,2144,2144,0,0,441074376,2171,43664,0,0,40394,1291876,,,0,,,0,0,0.000368,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587033317,0,ROLE,,,,,,0,,,
01ac2887-0404-8030-0031-15070045ef66,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD7 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:52.204Z,2023-05-08T23:23:52.327Z,1200123,22205131712,0.8807122244,2526146048,0,0,460125651,0,117092,0,0,0,7954,7954,0,0,947116649,2188,57411,0,0,176345,964179,,,0,,,0,0,0.000361,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587033230,0,ROLE,,,,,,0,,,
01ac2887-0404-8091-0031-1507004705a6,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD6 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:52.149Z,2023-05-08T23:24:15.814Z,1223665,5206661344,0.8619407961,681538560,0,0,127897929,0,265193,0,0,0,2149,2149,0,0,521437103,2862,32727,0,0,16019,1172057,,,0,,,0,0,0.000475,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587033184,0,ROLE,,,,,,0,,,
01ac2887-0404-806a-0031-150700473756,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD6 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:52.075Z,2023-05-08T23:33:47.299Z,1795224,22270986400,0.8816990989,2516410368,0,0,460142035,0,151433,0,0,0,7915,7948,0,0,1193958442,6444,157455,0,0,0,1631325,,,0,,,0,0,0.003152,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587034214,0,ROLE,,,,,,0,,,
01ac2887-0404-8091-0031-15070047059e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD4 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD4 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD4 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:51.876Z,2023-05-08T23:29:42.426Z,1550550,22507888452,0.8765553177,2559092736,0,0,460142035,0,272695,0,0,0,7934,7958,0,0,1930145901,2579,62523,0,0,32296,1453152,,,0,,,0,0,0.000424,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587033309,0,ROLE,,,,,,0,,,
01ac2887-0404-802d-0031-150700461d8e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:51.709Z,2023-05-08T23:19:57.426Z,965717,22588729101,0.8721345294,2478415872,0,0,460109267,0,398390,0,0,0,7933,7957,0,0,2681651785,2116,109006,0,0,157370,697225,,,0,,,0,0,0.000363,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032697,0,ROLE,,,,,,0,,,
01ac2887-0404-80d0-0031-150700475696,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_SECONDARY_CONDITION_MASK fhscm
SET fhscm.MASK_SEC_ICD9_DIAG_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'M'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT)       <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    UNION
    (
    SELECT DISTINCT(fhsc.facil_hdr_bid)
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER_SECONDARY_CONDITION as fhsc
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr 
    ON psr.ndw_plan_cd = fhsc.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fhsc.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL -- need to work on the TRIM command : maybe do an alter statement?
        -- these are filters on the join condition
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD' -- TODO: is this redundant? because action type A already enforced
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fhsc.facil_hdr_bid
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fhsc.memb_bid 
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.rndrng_prov_zip_cd 
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    -- last condition is to link data pk with masking table pk
    AND fhsc.facil_hdr_bid = fhscm.facil_hdr_bid
    )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:51.448Z,2023-05-08T23:10:38.474Z,407026,5475420212,0.6912225205,676976640,0,0,127897929,0,912780,0,0,0,2155,2155,0,0,1756959831,2630,44842,0,0,287542,72012,,,0,,,0,0,0.000437,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032551,0,ROLE,,,,,,0,,,
01ac2887-0404-806b-0031-150700467c06,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:51.321Z,2023-05-08T23:10:29.616Z,398295,4770192754,0.806687885,755377664,0,0,127529289,0,1711073,0,0,0,1773,1773,0,0,642679254,2010,87138,0,0,257611,51536,,,0,,,0,0,0.000369,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032153,0,ROLE,,,,,,0,,,
01ac2887-0404-80d0-0031-150700475692,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_HEADER_MASK  fhm
SET MASK_ADMTNG_DIAG_CD = 1 -- we will need to iterate through this
WHERE ( 
    EXISTS (
    (SELECT DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_DIAG_CD = sr.ATRBT_VAL 
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'M'
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
        ON zr.zip_cd = fh.memb_clm_zip_cd
        --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
    WHERE 
    sr.st_cd IN (zr.st_cd, psr.st_cd)
    AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
    DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
    DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
    )
    UNION -- Used Union rather than OR as per snowflake's performance recommendations
    (SELECT  DISTINCT(fh.FACIL_HDR_BID) 
    FROM NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
    LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
    ON psr.NDW_PLAN_CD = fh.bhi_home_plan_id_cd
    INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
        ON fh.ADMTNG_DIAG_CD = sr.ATRBT_VAL
        AND sr.actn_cd = 'A'
        AND sr.atrbt_cd = 'ICD9_DIAG_CD'
        AND sr.reg_typ_cd = 'P'
    INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
        ON mem.memb_bid = fh.memb_bid
    INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr 
        ON zr.zip_cd = fh.rndrng_prov_zip_cd
        --AND zr.st_cd = sr.st_cd 
    WHERE 
        sr.st_cd IN (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND 
    -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg
    -- last condition is to link data pk with masking table pk
    AND fh.facil_hdr_bid = fhm.facil_hdr_bid
        )
    ) -- Exists closes here
) -- where clause closes here;
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:51.121Z,2023-05-08T23:12:01.478Z,490357,16492049572,0.8233507534,2490065920,0,0,402460059,0,104782,0,0,0,6623,6782,0,0,80001735,1584,83185,0,0,277734,127854,,,0,,,0,0,0.000272,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032026,0,ROLE,,,,,,0,,,
01ac2887-0404-806a-0031-150700473752,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD9 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:51.041Z,2023-05-08T23:30:54.203Z,1623162,2834203744,0.9073399008,233863168,0,0,49864784,0,549177,0,0,0,1941,1941,0,0,494255679,6042,45646,0,0,77820,1493654,,,0,,,0,0,0.000951,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032457,0,ROLE,,,,,,0,,,
01ac2887-0404-80d0-0031-15070047568e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD9 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD9 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:50.970Z,2023-05-08T23:31:35.899Z,1664929,12446082944,0.9236096237,843109376,0,0,180226286,0,207529,0,0,0,7207,7405,0,0,798317853,2438,41877,0,0,2285,1618329,,,0,,,0,0,0.000403,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032228,0,ROLE,,,,,,0,,,
01ac2887-0404-8091-0031-15070047059a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD8 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD8 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD8 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.914Z,2023-05-08T23:13:01.345Z,550431,2852918304,0.9097520768,232428032,0,0,49864784,0,584900,0,0,0,1948,1948,0,0,535542137,1804,42541,0,0,199586,306500,,,0,,,0,0,0.000315,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031932,0,ROLE,,,,,,0,,,
01ac2887-0404-8089-0031-150700471a16,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD7 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.808Z,2023-05-08T23:16:17.225Z,746417,2844444224,0.909503913,232566784,0,0,49864784,0,616698,0,0,0,1946,1946,0,0,567663866,1989,28288,0,0,166765,549375,,,0,,,0,0,0.00034,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031946,0,ROLE,,,,,,0,,,
01ac2887-0404-8030-0031-15070045ef62,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD7 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD7 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:50.757Z,2023-05-08T23:26:37.498Z,1366741,12519446275,0.9209569384,844355072,0,0,180275438,0,255153,0,0,0,7232,7406,0,0,978424914,1766,72478,0,0,65899,1226598,,,0,,,0,0,0.000303,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031645,0,ROLE,,,,,,0,,,
01ac2887-0404-8097-0031-1507004728c2,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD6 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.699Z,2023-05-08T23:28:46.198Z,1495499,2855955552,0.9132142908,233880064,0,0,49864784,0,640039,0,0,0,1943,1943,0,0,598521832,2763,25444,0,0,57974,1409318,,,0,,,0,0,0.000472,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032196,0,ROLE,,,,,,0,,,
01ac2887-0404-806b-0031-150700467bfe,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD6 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD6 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.642Z,2023-05-08T23:30:50.568Z,1619926,12697131168,0.9324697647,842675712,0,0,180279534,0,272365,0,0,0,7302,7404,0,0,1049163366,2432,51689,0,0,29937,1535868,,,0,,,0,0,0.000402,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032170,0,ROLE,,,,,,0,,,
01ac2887-0404-802d-0031-150700461d82,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD5 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD5 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD5 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:50.590Z,2023-05-08T23:24:48.481Z,1257891,2861535168,0.9111920389,233615872,0,0,49864784,0,647727,0,0,0,1943,1943,0,0,622504715,2140,32944,0,0,31854,1190953,,,0,,,0,0,0.000364,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031942,0,ROLE,,,,,,0,,,
01ac2887-0404-8091-0031-150700470592,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD5 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD5 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD5 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.539Z,2023-05-08T23:29:28.054Z,1537515,12518818944,0.9324618513,841540608,0,0,180279534,0,289429,0,0,0,7207,7405,0,0,1105674494,2323,42176,0,0,24091,1468925,,,0,,,0,0,0.000393,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031958,0,ROLE,,,,,,0,,,
01ac2887-0404-80d0-0031-15070047568a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD4 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD4 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD4 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.484Z,2023-05-08T23:27:21.554Z,1411070,2862817536,0.9073462375,234655232,0,0,49864784,0,625803,0,0,0,1942,1942,0,0,617300498,2370,31409,0,0,42525,1334766,,,0,,,0,0,0.000395,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032068,0,ROLE,,,,,,0,,,
01ac2887-0404-8089-0031-150700471a12,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD4 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD4 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD4 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.423Z,2023-05-08T23:24:18.260Z,1227837,12524206016,0.9240795881,845212672,0,0,180275438,0,299225,0,0,0,7209,7407,0,0,1146153542,1759,48308,0,0,13416,1164354,,,0,,,0,0,0.000307,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031433,0,ROLE,,,,,,0,,,
01ac2887-0404-802d-0031-150700461d7e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD3 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD3 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.372Z,2023-05-08T23:20:24.500Z,994128,2863632640,0.9090516638,233189888,0,0,49864784,0,584150,0,0,0,1943,1943,0,0,595761597,2373,27351,0,0,219189,745215,,,0,,,0,0,0.000395,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031941,0,ROLE,,,,,,0,,,
01ac2887-0404-8089-0031-150700471a0e,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD2 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD2 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD2 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.220Z,2023-05-08T23:14:06.887Z,616667,12724397248,0.9269589456,842096640,0,0,180287726,0,286703,0,0,0,7314,7416,0,0,1139800168,2432,50811,0,0,200991,362433,,,0,,,0,0,0.000411,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031431,0,ROLE,,,,,,0,,,
01ac2887-0404-80d0-0031-150700475686,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD10 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD10 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD10 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.166Z,2023-05-08T23:26:06.865Z,1336699,2832790784,0.9075026192,233793536,0,0,49864784,0,521765,0,0,0,1942,1942,0,0,459845756,2950,31662,0,0,45686,1256401,,,0,,,0,0,0.000483,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032061,0,ROLE,,,,,,0,,,
01ac2887-0404-8030-0031-15070045ef56,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD10 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD10 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD10 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.114Z,2023-05-08T23:09:53.911Z,363797,12457287796,0.9273527372,832857088,0,0,178460910,0,184141,0,0,0,7237,7417,0,0,724583088,2053,55664,0,0,260030,46050,,,0,,,0,0,0.000362,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031432,0,ROLE,,,,,,0,,,
01ac2887-0404-8091-0031-15070047058e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:50.054Z,2023-05-08T23:08:58.463Z,308409,2899904827,0.5268581182,232050688,0,0,49864784,0,393426,0,0,0,1949,1949,0,0,466491079,3063,33304,0,0,244381,27661,,,0,,,0,0,0.000501,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031756,0,ROLE,,,,,,0,,,
01ac2887-0404-8089-0031-150700471a0a,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_SEC_ICD9_DIAG_CD1 = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.SEC_ICD9_DIAG_CD1 = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:49.994Z,2023-05-08T23:23:15.863Z,1165869,12514007040,0.8917265445,843269632,0,0,180287726,0,267983,0,0,0,7211,7409,0,0,1106220718,2292,44219,0,0,314640,804718,,,0,,,0,0,0.000392,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031430,0,ROLE,,,,,,0,,,
01ac2887-0404-8089-0031-150700471a06,"UPDATE NDWAE_REL_POC.NDWAE_MASK.FACILITY_CLAIM_XREF_MASK fcxm
SET MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS(
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL 
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'M'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.memb_clm_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
        UNION
        (SELECT 1 
        FROM NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS fcx
        INNER JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr -- Concerning that we need a left join
        ON psr.NDW_PLAN_CD = fcx.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON fcx.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL
            -- these are filters on the join condition
            AND sr.actn_cd = 'A'
            AND sr.atrbt_cd = 'ICD9_DIAG_CD'
            AND sr.reg_typ_cd = 'P'   
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER as mem
            ON mem.memb_bid = fcx.memb_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER as fh
        ON fh.facil_hdr_bid = fcx.facil_hdr_bid
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE AS zr -- using member zip code on claim, to link back to the zip reference and get st_cd
            ON zr.zip_cd = fh.rndrng_prov_zip_cd
            --AND zr.st_cd = sr.st_cd -- checking if the state code of the SR matches that of the claim
        WHERE
        sr.st_cd in (zr.st_cd, psr.st_cd)
        AND (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
        -- checking member age AT TIME OF SERVICE: criteria to apply state regs is 
        DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
        DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0 -- checking serving date compared to effective daes of state reg 
        -- last condition is to link data pk with masking table pk
        AND fcx.facil_hdr_bid = fcxm.facil_hdr_bid
        AND fcx.cycle_id = fcxm.cycle_id
        AND fcx.clm_ln_num = fcxm.clm_ln_num
        )
    )
    
);",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:49.721Z,2023-05-08T23:17:16.227Z,806506,11776341056,0.9216379217,843155968,0,0,180287726,0,294926,0,0,0,6958,7411,0,0,1328309305,2545,54840,0,0,133719,615402,,,0,,,0,0,0.000428,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031429,0,ROLE,,,,,,0,,,
01ac2887-0404-806a-0031-15070047374e,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.ADMISSION_AGGREGATE_INBOUND_MASK aaim
SET MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        --INNER JOIN ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER mem on mem.memb_bid = fh.memb_bid
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'A'
            AND sr.ATRBT_CD = 'ICD9_DIAG_CD'
            AND sr.REG_TYP_CD = 'P'
        WHERE
        sr.st_cd IN (zp.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
    )
    UNION
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        --INNER JOIN ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER MEM on MEM.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'A'
            AND sr.ATRBT_CD = 'ICD9_DIAG_CD'
            AND sr.REG_TYP_CD = 'M'
        WHERE
        sr.st_cd IN (zm.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
        )    
    )
)
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,1,,SUCCESS,,,2023-05-08T23:03:49.675Z,2023-05-08T23:13:15.914Z,566239,2551086163,0.855226358,15308288,0,0,3412364,0,37542,0,0,0,2025,2025,0,0,1356096834,4111,14395,0,0,237637,310096,,,0,,,0,0,0.000659,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032067,0,ROLE,,,,,,0,,,
01ac2887-0404-8030-0031-15070045ef52,"UPDATE NDWAE_REL_POC.NDWAE_MASK.ADMISSION_AGGREGATE_INBOUND_MASK aaim
SET MASK_PRINC_ICD9_DIAG_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        --INNER JOIN ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER mem on mem.memb_bid = fh.memb_bid
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'A'
            AND sr.ATRBT_CD = 'ICD9_DIAG_CD'
            AND sr.REG_TYP_CD = 'P'
        WHERE
        sr.st_cd IN (zp.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
    )
    UNION
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        --INNER JOIN ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE.MEMBER MEM on MEM.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.PRINC_ICD9_DIAG_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'A'
            AND sr.ATRBT_CD = 'ICD9_DIAG_CD'
            AND sr.REG_TYP_CD = 'M'
        WHERE
        sr.st_cd IN (zm.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
        )    
    )
)
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:49.628Z,2023-05-08T23:08:28.621Z,278993,12642185511,0.5509044526,50108416,0,0,12349265,0,35057,0,0,0,6998,7453,0,0,1626498300,3451,32268,0,0,222726,20548,,,0,,,0,0,0.000559,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587031641,0,ROLE,,,,,,0,,,
01ac2887-0404-806a-0031-15070047374a,"UPDATE NDWAE_REL_POC.NDWAE_ANTHEM_MASK.ADMISSION_AGGREGATE_INBOUND_MASK aaim
SET MASK_DIAG_DIGIT123_CD = 1 -- we will need to iterate through this
WHERE (
    EXISTS (
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        --INNER JOIN ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER mem on mem.memb_bid = fh.memb_bid
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.DIAG_DIGIT123_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'A'
            AND sr.ATRBT_CD = 'ICD9_DIAG_CD'
            AND sr.REG_TYP_CD = 'P'
        WHERE
        sr.st_cd IN (zp.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
    )
    UNION
    (SELECT 1 FROM NDWAE_REL_POC.NDWAE_ANTHEM.ADMISSION_AGGREGATE_INBOUND AS AAI
        LEFT JOIN NDWAE_REL_POC.NDWAE.PLAN_STATE_REFERENCE AS psr
        ON psr.NDW_PLAN_CD = AAI.bhi_home_plan_id_cd
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_CLAIM_XREF AS FX ON FX.cycle_id = AAI.cycle_id AND AAI.facil_hdr_admsn_bid = fx.facil_hdr_admsn_bid 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.FACILITY_HEADER AS FH ON FH.FACIL_HDR_BID = FX.FACIL_HDR_BID
        INNER JOIN NDWAE_REL_POC.NDWAE.ZIP_REFERENCE ZM on FH.MEMB_CLM_ZIP_CD = ZM.ZIP_CD
        --INNER JOIN ZIP_REFERENCE ZP on FH.RNDRNG_PROV_ZIP_CD = ZP.ZIP_CD 
        INNER JOIN NDWAE_REL_POC.NDWAE_ANTHEM.MEMBER MEM on MEM.MEMB_BID = FH.MEMB_BID
        INNER JOIN NDWAE_REL_POC.UTILITIES.STATE_REGS as sr
            ON AAI.DIAG_DIGIT123_CD = sr.ATRBT_VAL
            AND sr.ACTN_CD = 'A'
            AND sr.ATRBT_CD = 'ICD9_DIAG_CD'
            AND sr.REG_TYP_CD = 'M'
        WHERE
        sr.st_cd IN (zm.st_cd, psr.st_cd)
        AND 
        (sr.HI_AGE_YR_NUM is NULL OR (sr.HI_AGE_YR_NUM is not NULL AND DATEDIFF(year, mem.memb_brth_dt, fh.FIRST_SERV_DT) <= sr.HI_AGE_YR_NUM)) AND
            DATEDIFF(day, sr.reg_eff_dt, fh.FIRST_SERV_DT) > 0 AND 
            DATEDIFF(day,sr.reg_end_dt, fh.FIRST_SERV_DT) < 0
        AND aai.facil_hdr_admsn_bid = aaim.facil_hdr_admsn_bid
        AND aai.cycle_id = aaim.cycle_id
        AND aai.bhi_home_plan_id_cd = aaim.bhi_home_plan_id_cd
        )    
    )
)
;",823461756,NDWAE_REL_POC,,,UPDATE,13815393671721194,BCBSA_SNFLK_SRVC_USER,SNOWFLAKE_ENGINEER_SRVC_ONLY,13,REL_BI_WH,X-Large,STANDARD,2,,SUCCESS,,,2023-05-08T23:03:49.573Z,2023-05-08T23:09:02.203Z,312630,1681803168,0.9877196949,15308288,0,0,3412364,0,1415,0,0,0,1071,2025,0,0,1102162080,3808,33381,0,0,233255,42186,,,0,,,0,0,0.000616,7.15.0,0,0,0,0,0,100,false,0,0,0,1683587032063,0,ROLE,,,,,,0,,,
